<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Vim auto-capitalisation</title>
<meta name="viewport" content="width=device-width">
<meta name="description" content="A blog about programming">
<link rel="canonical" href="https://davidxmoody.com//vim-auto-capitalisation/">
<link rel="stylesheet" href="/css/main-2230ce327c6db30770a69ecc9bbc545d.css">
<meta name="wot-verification" content="fdff4a26070b9df2fd1a" />
</head>

<body>

<div class="wrapper">
<header class="site-header">
<h1><a href="/">David Moody</a></h1>
<p>A blog about programming</p>
</header>

<div class="content">
<article>
<header>
<h1>Vim auto-capitalisation</h1>
<p><em>Aug 29, 2014</em></p>
</header>
<div>
<p>Continuing in the same theme as my <a href="/better-vim-abbreviations/">last post</a>, I am going to write about another awesome Vim tip I found recently. That is: automatic capitalisation of the first letter of each sentence. </p>
<p>Many word processors already include this. For some reason, Vim and other text editors don&#39;t usually have the option. I don&#39;t know why. I feel that a lot of unnecessary key-strokes are wasted on the shift keys. It also stresses the little fingers and twists the wrists.</p>
<!--more-->
<h2 id="the-scripts">The scripts</h2>
<p>There is surprisingly little information available about this. The only decent thing I&#39;ve ever found has been <a href="http://superuser.com/questions/737130/automatically-capitalize-the-first-letter-of-sentence-in-vim">this superuser question/answer</a>. There are two answers, both of which I like:</p>
<pre><code class="lang-vim"><span class="hljs-keyword">for</span> char in <span class="hljs-built_in">split</span>(<span class="hljs-string">'abcdefghijklmnopqrstuvwxyz'</span>, <span class="hljs-string">'\zs'</span>)
    <span class="hljs-keyword">exe</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"inoremap &lt;expr&gt; %s search('[.!?]\\_s\\+\\%%#', 'bcnw') ? '%s' : '%s'"</span>, char, <span class="hljs-built_in">toupper</span>(char), char)
<span class="hljs-keyword">endfor</span>
</code></pre>
<p>The above script creates insert mode mappings for every lower-case letter. It uses the <code>&lt;expr&gt;</code> option to evaluate an expression instead of mapping directly to another key. That expression then searches backwards to check for certain punctuation. It then returns either the original character or the upper-case version of the character if a match was found. </p>
<p>I like it but I prefer the second answer:</p>
<pre><code class="lang-vim"><span class="hljs-keyword">augroup</span> SENTENCES
    au!
    <span class="hljs-keyword">autocmd</span> InsertCharPre * <span class="hljs-keyword">if</span> <span class="hljs-built_in">search</span>(<span class="hljs-string">'\v(%^|[.!?]\_s)\_s*%#'</span>, <span class="hljs-string">'bcnw'</span>) != <span class="hljs-number">0</span> | <span class="hljs-keyword">let</span> <span class="hljs-variable">v:char</span> = <span class="hljs-built_in">toupper</span>(<span class="hljs-variable">v:char</span>) | <span class="hljs-keyword">endif</span>
<span class="hljs-keyword">augroup</span> END
</code></pre>
<p>Here, instead of creating mappings, an auto-command is used. It &quot;listens&quot; for characters to be inserted and intercepts them. It searches backwards for punctuation and converts the character to be inserted (<code>v:char</code>) to upper-case. The <code>augroup</code> and <code>au!</code> stuff is just for grouping and isn&#39;t terribly important.</p>
<p>If you want to bypass the script(s) and force a lower-case letter to be inserted, you can press Ctrl+V followed by the letter. </p>
<h2 id="customisation">Customisation</h2>
<p>I&#39;ll be the first to admit that my Vimscript isn&#39;t the best. Nevertheless, I still wanted to change a few things based on the way I type. I wanted to add a few more contexts in which letters get capitalised:</p>
<ul>
<li>Markdown list items</li>
<li>YAML front matter titles</li>
<li>New paragraphs (which happen to come after something that doesn&#39;t end in a punctuation mark)</li>
</ul>
<p>Here is my tweaked script:</p>
<pre><code class="lang-vim"><span class="hljs-keyword">augroup</span> SENTENCES
    au!
    <span class="hljs-keyword">autocmd</span> InsertCharPre * <span class="hljs-keyword">if</span> <span class="hljs-built_in">search</span>(<span class="hljs-string">'\v(%^|[.!?]\_s+|\_^\-\s|\_^title\:\s|\n\n)%#'</span>, <span class="hljs-string">'bcnw'</span>) != <span class="hljs-number">0</span> | <span class="hljs-keyword">let</span> <span class="hljs-variable">v:char</span> = <span class="hljs-built_in">toupper</span>(<span class="hljs-variable">v:char</span>) | <span class="hljs-keyword">endif</span>
<span class="hljs-keyword">augroup</span> END
</code></pre>
<p>It can be tricky to figure out what&#39;s going on in a regular expression like that. I think the <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html#pattern-overview">Vim documentation on patterns</a> is pretty helpful. Here is a <em>very brief</em> summary of what&#39;s going on:</p>
<ul>
<li><code>\v</code> means that the following pattern is &quot;very magic&quot; so not as many characters need to be escaped</li>
<li><code>%^</code> is the start of the file</li>
<li><code>[.!?]\_s+</code> is a punctuation mark followed by some whitespace which may or may not include newlines</li>
<li><code>\_^\-\s</code> is a dash at the start of a line followed by a whitespace character</li>
<li><code>\_^title\:\s</code> is &quot;title: &quot; at the start of a line</li>
<li><code>\n\n</code> matches two newlines</li>
<li><code>%#</code> matches the cursor position</li>
<li>The <code>&#39;b&#39;</code> option means search backwards</li>
</ul>
<p><em>[Edit on 2014-09-29: I somehow forgot to add Markdown headers to the list of capitalisation contexts. I will leave that as an exercise for the reader.]</em></p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>Combining this with the rest of my configuration options gives the following section of my <code>.vimrc</code> file:</p>
<pre><code class="lang-vim">func! WordProcessorMode()
    <span class="hljs-string">" Load Markdown syntax highlighting but with custom hashtag support
</span>    <span class="hljs-keyword">set</span> <span class="hljs-keyword">filetype</span>=mkd
    syn <span class="hljs-built_in">match</span> htmlBoldItalic <span class="hljs-string">"#[-_a-zA-Z0-9]\+"</span>

    <span class="hljs-string">" Other options
</span>    <span class="hljs-keyword">set</span> nonumber
    <span class="hljs-keyword">set</span> wrap
    <span class="hljs-keyword">set</span> linebreak
    <span class="hljs-keyword">set</span> breakat=\ 
    <span class="hljs-keyword">set</span> <span class="hljs-keyword">display</span>=lastline
    <span class="hljs-keyword">set</span> tabstop=<span class="hljs-number">4</span>
    <span class="hljs-keyword">set</span> softtabstop=<span class="hljs-number">4</span>
    <span class="hljs-keyword">set</span> <span class="hljs-built_in">shiftwidth</span>=<span class="hljs-number">4</span>
    <span class="hljs-keyword">set</span> formatoptions=
    <span class="hljs-keyword">set</span> spell spelllang=en_gb
    <span class="hljs-keyword">source</span> ~/.<span class="hljs-keyword">vim</span>/abbreviations.<span class="hljs-keyword">vim</span>

    <span class="hljs-string">" Auto-capitalize script
</span>    <span class="hljs-keyword">augroup</span> SENTENCES
        au!
        <span class="hljs-keyword">autocmd</span> InsertCharPre * <span class="hljs-keyword">if</span> <span class="hljs-built_in">search</span>(<span class="hljs-string">'\v(%^|[.!?]\_s+|\_^\-\s|\_^title\:\s|\n\n)%#'</span>, <span class="hljs-string">'bcnw'</span>) != <span class="hljs-number">0</span> | <span class="hljs-keyword">let</span> <span class="hljs-variable">v:char</span> = <span class="hljs-built_in">toupper</span>(<span class="hljs-variable">v:char</span>) | <span class="hljs-keyword">endif</span>
    <span class="hljs-keyword">augroup</span> END
endfu

com! WP <span class="hljs-built_in">call</span> WordProcessorMode()
<span class="hljs-keyword">au</span> BufNewFile,BufRead *.mkd <span class="hljs-built_in">call</span> WordProcessorMode()
<span class="hljs-keyword">au</span> BufNewFile,BufRead *.md <span class="hljs-built_in">call</span> WordProcessorMode()
<span class="hljs-keyword">au</span> BufNewFile,BufRead diary-*.txt <span class="hljs-built_in">call</span> WordProcessorMode()
</code></pre>
</div>
</article>
</div>

<div class="push"></div>
</div>

<footer class="site-footer">
<br>
<p>
<a href="/feed.xml">RSS</a> |
<a href="https://github.com/davidxmoody">GitHub</a> |
<a href="mailto:david@davidxmoody.com">Email</a>
</p>
<p>
This blog is available under a
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        Creative Commons License
      </a>
</p>
</footer>

<script>
(function(i, s, o, g, r, a, m) {
				i['GoogleAnalyticsObject'] = r;
				i[r] = i[r] || function() {
								(i[r].q = i[r].q || []).push(arguments)
				}, i[r].l = 1 * new Date();
				a = s.createElement(o),
								m = s.getElementsByTagName(o)[0];
				a.async = 1;
				a.src = g;
				m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-54505873-1', 'auto');
ga('send', 'pageview');
</script>

</body>

</html>