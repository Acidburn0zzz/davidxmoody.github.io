<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Paragraph counts in jekyll</title><meta name="viewport" content="width=device-width"><meta name="description" content="A blog about programming"><link rel="canonical" href="http://davidxmoody.com/paragraph-counts-in-jekyll/"><link rel="stylesheet" href="/css/main.css"><meta name="wot-verification" content="fdff4a26070b9df2fd1a"/></head><body><div class="wrapper"> <header class="site-header"><h1><a href="/">David Moody</a></h1><p>A blog about programming</p> </header><div class="content"> <article> <header><h1>Paragraph counts in jekyll</h1><p><em>Aug 15, 2014</em></p> </header><p>I’m a big fan of <a href="http://arstechnica.com/">Ars Technica</a>. There is one thing I particularly like about their RSS feed. It shows the first few paragraphs of the article followed by a link saying “Read X remaining paragraphs”.</p><p>If I can’t read the full article from an RSS feed, this is the next best option. It has two big advantages:</p><ul><li>It contains enough of the article to let you know if you will want to read the whole thing</li><li>It lets you know how long the entire article will be</li></ul><p>I’ve seen many <em>bad</em> approaches to the same problem. Some feeds contain very limited information, frequently just the first paragraph of the article. I feel that the first paragraph alone is not usually enough to decide if the entire article is worth reading.</p><h2 id="emulating-it-in-jekyll">Emulating it in Jekyll</h2><p>I wanted something like this for my blog. Both for the summary of all posts on the front page and also for the RSS feed.</p><p>Jekyll already contains support for excerpts (accessible with <code>post.excerpt</code>). By default, the excerpt of a post will be the first paragraph.</p><p>However, jekyll also supports setting a custom <code>excerpt_separator</code> variable in the <code>_config.yml</code> file. I changed mine to be two empty lines instead of the default of one.</p><div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">excerpt_separator</span><span class="p-Indicator">:</span> <span class="s">"\n\n"</span>    <span class="c1"># Default</span>
<span class="l-Scalar-Plain">excerpt_separator</span><span class="p-Indicator">:</span> <span class="s">"\n\n\n"</span>  <span class="c1"># My version</span></code></pre></div><p>In each of my posts I then add an extra new line after the point I want the excerpt to end. You could choose anything for the excerpt separator but I like this because it is simple and doesn’t mess with the Markdown processing.</p><h2 id="counting-paragraphs">Counting paragraphs</h2><p>Now that we’ve defined a custom, multi-paragraph excerpt, we still need to count the number of <em>remaining</em> paragraphs in the post.</p><p>Liquid templates weren’t really designed for this kind of stuff and they lack full regular expression support. However, they do have the very convenient <code>split</code> filter which we will be using. We can split the formatted HTML of the post on the <code>'&lt;p&gt;'</code> substring. This will break it into segments for each paragraph. One slight caveat is that there will be an empty string before the first paragraph.</p><div class="highlight"><pre><code class="language-html" data-lang="html">{% assign total_paragraphs = post.content | split: '<span class="nt">&lt;p&gt;</span>' | size | minus: 1 %}
{% assign excerpt_paragraphs = post.excerpt | split: '<span class="nt">&lt;p&gt;</span>' | size | minus: 1 %}
{% assign remaining_paragraphs = total_paragraphs | minus: excerpt_paragraphs %}
<span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ post.url }}"</span><span class="nt">&gt;</span>Read {{ remaining_paragraphs }} remaining paragraphs...<span class="nt">&lt;/a&gt;&lt;/p&gt;</span></code></pre></div><h2 id="short-posts">Short posts</h2><p>What if you want to write a short post though? One where you want the excerpt to equal the entire post. Not a problem. If you simply don’t include the <code>excerpt_separator</code> in your post then the excerpt will be equal to the full content of the post.</p><p>You could also change the wording a bit:</p><div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ post.url }}"</span><span class="nt">&gt;</span>
  {% if remaining_paragraphs &gt; 0 %}
  Read {{ remaining_paragraphs }} remaining paragraphs...
  {% else %}
  View post on separate page
  {% endif %}
<span class="nt">&lt;/a&gt;&lt;/p&gt;</span></code></pre></div></article></div><div class="push"></div></div><footer class="site-footer"><p> <br> <a href="http://feeds.feedburner.com/davidxmoody">RSS</a> | <a href="https://github.com/davidxmoody">GitHub</a> | <a href="mailto:david@davidxmoody.com">Email</a></p><p> This blog is available under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0 License</a></p> </footer><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-54505873-1","auto"),ga("send","pageview")</script></body></html>